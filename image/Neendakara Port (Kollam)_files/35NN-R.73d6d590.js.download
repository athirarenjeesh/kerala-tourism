(this.$WP=this.$WP||[]).push(["_azji4/35NN-R",(e,l)=>{"use strict";var t,a,n,r,i,o,u,s,d,c,m,E,C,f,I,b,v,L,A,y,R,g,p,_,M,S,w,T,O,k,N,h,P="ffEXr w G5",G=20,V=e=>{var l,V,D,U,W,x,Y,H,F,{albumId:B,referenceMediaId:q,categoryId:K,typeId:Q,mediaId:z,locationId:X,locationName:$,secondaryTitleContent:j,actionHandler:Z,offer:J,adSlot:ee,businessContact:le,skipQuickAlbums:te,disableControls:ae,getShareUrlForMedia:ne,galleryRendererOverride:re,fullscreenRendererOverride:ie,sort:oe,quickAlbumsConfiguration:ue,queryClientOverride:se,heroDataStrategyOverride:de,pageDataStrategyOverride:ce,trackingCallback:me}=e,{localize:Ee}=M(),Ce=C(),fe=se||"mv",Ie=de||"mvh",be=ce||("RECENCY"===oe?"mr":"m"),ve=ue||"mvqa",Le=u(B),Ae=A(fe,Ie,X),ye=A(fe,ve,X),Re=t.useCallback((e=>{var l,t="",a=null==e||null==(l=e.mediaAlbum)?void 0:l.album;if(a)if(200!==e.mediaAlbum.status)t=R;else if(0===a.totalMediaCount)t=y;else{var n;t=(null==(n=a.mediaList)?void 0:n[0])?p:g}else t=y;Ae(t)}),[Ae]),ge=t.useCallback((e=>{var l=null==e?void 0:e.mediaWindow;if(l){var t="";if(200!==(null==l?void 0:l.status))t=R;else{var a,n,r,i,o=null==l||null==(a=l.windowPanes)||null==(n=a[0])||null==(r=n.albums)?void 0:r[0];t=o&&0!==o.totalMediaCount?(null==o||null==(i=o.mediaList)?void 0:i[0])?p:g:y}ye(t)}}),[ye]),pe={locationId:X,albumId:B===s.PANO_ALBUM?s.ALL_ALBUMS:B,client:fe,dataStrategy:Ie,filter:d(Q),subAlbumId:B===s.PANO_ALBUM?s.PANO_ALBUM:K,referenceMediaId:q},[_e]=a({query:n,variables:pe}),{fetching:Me,data:Se,error:we}=_e,Te=null==Se||null==(l=Se.mediaAlbum)?void 0:l.status,Oe=Me?null:null==Se||null==(V=Se.mediaAlbum)?void 0:V.album;if(we){var ke=we.message.replace(/Error #[0-9]+/g,"Error #xxx");console.error("[MASDesktopMediaViewer] albumQuery",ke),Oe||Z({type:"ERROR",albumId:B,statusCode:-1,errorMessage:we.message})}Te&&Te>=400&&q&&(console.error(`[MASDesktopMediaViewer] albumQuery received status ${Te}`),Z({type:"ERROR",albumId:B,statusCode:Te})),t.useEffect((()=>{Me||Re(Se)}),[Se,Me,Re]);var Ne=null==Oe||null==(D=Oe.mediaList)?void 0:D[0],he=(null==Oe?void 0:Oe.offset)||0,Pe=t.useMemo((()=>({locationId:X,albumId:B===s.PANO_ALBUM?s.ALL_ALBUMS:B,subAlbumId:B===s.PANO_ALBUM?s.PANO_ALBUM:K,client:fe,dataStrategy:be,filter:d(Q),offset:0,limit:G})),[X,B,K,fe,be,Q]),[Ge,Ve]=r({query:i,variables:Pe}),De=Object.keys(Ge).length,Ue=t.useCallback((e=>{var l=Math.abs(Math.floor(e/G));return null!=Ge&&Ge[l]?null==Ge?void 0:Ge[String(l)]:(Ve({offset:l*G,limit:G}),Z({type:"PAGED",pageNumber:l}),{fetching:!0,data:null})}),[Ve,Ge,Z]),{fetching:We}=Ge[0];t.useEffect((()=>{We||Ce(f.GALLERY_VIEW_PHOTOS_SEEN,{photosSeen:De*G})}),[We,De,Ce]);var xe=t.useCallback((e=>{var l,t,a;if(e===he&&oe!==c.RECENCY)return Ne;var n=e,r=Ue(n);return null!=r&&r.fetching?null:null==r||null==(l=r.data)||null==(t=l.mediaAlbumPage)||null==(a=t.mediaList)?void 0:a[n%G]}),[Ue,Ne,he,oe]),Ye=t.useCallback((e=>{var l=xe(e);return l?{media:l,loading:!1}:{loading:!0}}),[xe]),He=t.useRef({...E}),[Fe,Be]=t.useState(!1),qe=e=>{Be(e)},Ke=t.useCallback(((e,l)=>{var a=xe(e);ie&&ie(a);var n=(null==Oe?void 0:Oe.totalMediaCount)||0;return a?t.createElement(b,{media:a,shareUrl:ne?ne(a):null,totalMediaInfo:{selectedIndex:e,totalCount:n},onSwipeRight:()=>{},onSwipeLeft:()=>{},innateTranslations:!1,businessContact:le,onFullscreenMedia:qe,locationId:X,isActiveViewer:l,trackingCallback:me}):null}),[xe,ie,ne,Oe,le,X,me]),Qe="grid",ze=t.useRef(!1),Xe={locationId:X,client:fe,filter:m(),configuration:ve},[$e]=a({query:o,variables:Xe,pause:!!te}),{data:je,fetching:Ze,error:Je}=$e;Je&&Z({type:"ERROR",albumId:B,statusCode:-1,errorMessage:Je.message}),Ze||ge(je);var el=null==je||null==(U=je.mediaWindow)||null==(W=U.windowPanes)||null==(x=W[0])?void 0:x.albums,ll=el&&el.map((e=>{var l,a;return{id:e.albumId,titleNode:t.createElement(_,{count:e.totalMediaCount,title:e.name}),thumbnailNode:t.createElement(I,{width:"100%",height:"100%",sources:(null==(l=e.mediaList)||null==(a=l[0])?void 0:a.photoSizes)||[]})}})),tl=null==je||null==(Y=je.mediaWindow)||null==(H=Y.windowPanes)||null==(F=H[0])?void 0:F.albums,al={locationId:X,albumId:B,client:fe,filter:m(),configuration:Le},[nl]=a({query:o,variables:al,pause:!!ae}),{data:rl,error:il}=nl;il&&Z({type:"ERROR",albumId:B,statusCode:-1,errorMessage:il.message});var ol=t.useCallback((e=>{Z({type:"SOURCE_CHANGE",typeId:e}),Ce(f.GALLERY_VIEW_TYPE_CLICK,{typeId:e}),Ce(f.SOURCE_FILTER_CLICK,{typeId:e})}),[Z,Ce]),ul=t.useCallback((e=>{Z({type:"CATEGORY_CHANGE",categoryId:e}),Ce(f.GALLERY_VIEW_CATEGORY_CLICK,{categoryId:e}),Ce(f.ADVANCED_FILTER_CLICK,{categoryId:e})}),[Z,Ce]),[sl,dl]=t.useState(96),cl=e=>{dl(e)},[ml,El]=t.useState(!1),Cl=e=>{El(e)},fl=t.useCallback((e=>{Z({type:"SORT",sort:e}),Ce(f.SORT_TYPE_CHANGE,{sort:e})}),[Z,Ce]),Il=t.useCallback((()=>{var e,l;if(rl&&null!=(e=rl.mediaWindow)&&null!=(l=e.windowPanes[0])&&l.albums){var a,{albums:n}=rl.mediaWindow.windowPanes[0];if(B===s.TRAVELER_ALBUM){var r=tl&&tl.find((e=>e.albumId===s.TRAVELER_ALBUM));a={mediaCounts:{TRAVELER:(null==r?void 0:r.totalMediaCount)||0}}}else a=n.find((e=>e.albumId===K));var i,o,u,d=a?a.mediaCounts:null;if(d)return t.createElement("div",{className:"bHFqA"},t.createElement("div",{className:P},t.createElement(w,{key:"MVControlsContainer",onHeightChange:cl,filterExpand:ml},t.createElement("div",{className:"IEGrQ w Pp f k"},t.createElement("div",{className:"fNmCO"},t.createElement("div",{className:"egocv"},t.createElement(T,{selectedSourceId:Q,sourceCounts:d,onSelect:ol}),t.createElement(O,{albums:null==rl||null==(i=rl.mediaWindow)||null==(o=i.windowPanes)||null==(u=o[0])?void 0:u.albums,selectedTypeId:Q,onSelect:ul,selectedFilterId:K,selectedAlbumId:B,onExpandChange:Cl}))),t.createElement("div",null,t.createElement(k,{selectedSort:null!=oe?oe:c.ML,onSelect:fl}))))))}return t.createElement("div",{className:P,key:"MVControlsContainer"},t.createElement(w,{header:"",loading:!0,onHeightChange:cl,filterExpand:ml},t.createElement(N,{height:"100%"})))}),[rl,K,Q,B,ul,ol,tl,ml,oe,fl]),bl=t.useRef(!q);!bl.current&&He.current.setSelectedIndex&&Oe&&(Oe.offset||0===Oe.offset)&&(He.current.setSelectedIndex(Oe.offset),bl.current=!0);var vl=t.useCallback((e=>{switch(e.type){case v.albumSelect:Z({type:"ALBUM",referenceCompoundMediaId:null,albumId:e.albumId}),Ce(f.GALLERY_VIEW_ALBUM_CLICK,{albumId:e.albumId});break;case v.galleryItemClicked:Ce(f.DETAIL_VIEW_GALLERY_CLICK,{tileDetails:{offset:e.offset,mode:e.mode},isMWRedesign:!0}),Ce(f.GRID_VIEW_ITEM_CLICK),Be(!1),Z({type:"GALLERY_CLICK",selectedIndex:e.selectedIndex,offset:e.offset,mode:e.mode,newMedia:Ye(e.selectedIndex)});break;case v.fullscreenNav:Z({type:"FULLSCREEN_NAV",newMedia:Ye(e.newIndex),newIndex:e.newIndex});break;case v.fullscreenClose:Ce(f.DETAIL_VIEW_DISMISS,{mvDetailViewCloseType:"controls"===e.closeType?"album_change":e.closeType}),Ce(f.VIEW_GALLERY_BUTTON_CLICK),Z({type:"FULLSCREEN_CLOSE",closeType:e.closeType});break;case v.scroll:!ze.current&&e.position>0&&(Ce(f.GALLERY_VIEW_SCROLL_ENGAGEMENT),ze.current=!0),Z({type:"SCROLL",position:e.position});break;case v.close:Z({type:"CLOSE"})}}),[Z,Ye,Qe,Ce]);t.useEffect((()=>{He.current.backToTop(),He.current.closeDetail(),Ce(f.GALLERY_VIEW,{isMWRedesign:!0}),ze.current=!1}),[B,Q,K,Ce]),t.useEffect((()=>{z||He.current.closeDetail()}),[z]);var Ll=()=>t.createElement(L,{layout:Qe});return t.createElement(S,{close:()=>Z({type:"CLOSE"}),galleryRenderer:(e,l,a)=>{var n=xe(e);return re?re(n,l,a):n?t.createElement(h,{media:n,width:l,height:a,locationId:X}):null},fullRenderer:Ke,galleryOffsetTop:ae?0:sl-2,controlsRenderer:ae?null:Il,totalCount:(null==Oe?void 0:Oe.totalMediaCount)||0,quickAlbumsDefinition:ll,selectedAlbumId:B,actionHandler:vl,onTileGalleryControls:e=>{He.current=e},disableFullscreenNavigation:Fe,disableFullscreenClose:Fe,titleText:$&&Ee.string("PhotocC_ffffe1a6",{1:$}),secondaryTitleContent:j,secondaryHeaderContent:J,auxiliaryComponent:ee?ee():null,layoutStyle:Qe,detailCloseButton:t.createElement(Ll,null),useHero:!1,noHistoryManipulation:!0})};return[()=>{e("default",t.memo(V))},[e=>t=e,e=>a=e.useQuery,e=>(n=e.albumQuery,r=e.usePaginatedQuery,i=e.albumPageQuery,o=e.quickAlbumsQuery),e=>(u=e.getRHRFiltersWindowConfig,s=e.AlbumTypes,d=e.getFilter,c=e.mediaSortType,m=e.getMediaFilterToRetrieveAllPhotos),e=>E=e.DEFAULT_CONTROLS,e=>(C=e.useMVTracking,f=e.trackedPageActions),e=>I=e.ResponsiveImage,e=>b=e.MWDetailViewer,e=>v=e.mvActions,e=>L=e.GalleryButton,e=>(A=e.useMediaTracking,y=e.NO_PHOTO,R=e.ERROR_MSG,g=e.PRIMARY_MISSING,p=e.PRIMARY_OK),e=>_=e.StockTitle,e=>M=e.useLocalize,e=>S=e.DesktopViewer,e=>w=e.ControlsContainer,e=>(T=e.SourceFilterDropdown,O=e.AlbumPills,k=e.SortDropdown),e=>N=e.default,e=>h=e.default]]},["cDcdfi","5X2em-","n4rOEs","wc54S1","vYoxP4","yOERmA","KwOV1Z","pCKTMp","1yAwqb","egvnuD","zdk9wF","UuUmq4","0DsHEV","EwqHnS","xTNd-J","5lGCzf","Xi-2HZ","MTPLEG"]]);
