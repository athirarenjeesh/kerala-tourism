(this.$WP=this.$WP||[]).push(["mT-Pb2",(e,n)=>{"use strict";var o,a,r,t,l,i,s,u,c,d,f,g,p,C,m,y,S,v,I,M,h,K,O,P,k,w,x,b,L,B,N,D,T,E=({onSuccess:e,onClose:n,variant:r,disableClose:t=!1,funnelKey:l,pid:i,requireSecure:s,forceLogin:u,additionalInfo:g})=>{var C=f(),[{page:m},{uid:y}]=o.useContext(p),S=o.createRef(),[v,I]=a(!0),[M,h]=a("splash");return o.useEffect((()=>{I("splash"===M)}),[M,I]),o.createElement(c,{onClose:()=>{n&&n()},onBack:()=>(()=>{var e,n;C({actionType:"click",actionSubType:"OptimusLoginModalClick",itemType:"optimusLoginModalBackButton",team:"Plus",externalKey:l,pageUid:y,itemName:"OptimusLoginModal",page:m});var o=JSON.stringify({action:"back"});null==(e=S.current)||null==(n=e.contentWindow)||n.postMessage(o,"*")})(),hideCloseButton:t,hideBackButton:v,overrideContentStyling:!0},o.createElement(d,{pid:i,funnelKey:l,onLoginSuccess:()=>{e&&e()},variant:r,requireSecure:s,forceLogin:u,additionalInfo:g,onFlowStepChange:e=>{h(e)},forwardedRef:S}))},q=()=>{var{preferences:{currency:e}}=r(C),{getDiscountCode:n}=S(),o=n(),a=!o,{subscriptionPrice:t,fetching:l}=y(e,o,a,"CHECKOUT");if(l)return null;var i=null==t?void 0:t.trialPeriod;return((null==i?void 0:i.numberOfDays)||0)>0?"testFreeTrial":"test"},R=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],V=({allowClose:e,flow:n,forceLogin:a,useValuePropVariant:r=!0,contextualMessagingVariant:i,contextualMessageKey:c,contextualMessageParamKey:d,contextualMessageParam:f,contextualMessageSubheaderKey:g,isSignInOnly:p,onClose:C,onFailure:y,funnelKey:S,pid:v=40777,additionalInfoOnLoginContent:I,variantOverride:M})=>{var{userId:h}=o.useContext(m),{login:K,close:O}=s(),[w,x]=o.useState({onClose:void 0,onSuccess:void 0,funnelKey:void 0,requireSecure:!1}),b=k();M&&(b=M);var L=t((()=>({...i?{}:{contextualMessage:c,contextualMessageParamKey:d,contextualMessageParam:f,contextualMessageSubheader:g},isSignInOnly:p,contextualMessagingVariant:i,funnelKey:S})),[c,f,d,g,i,p,S]),B=R.includes((n||"").toUpperCase()),N=u((()=>b&&"control"!==b?o.createElement(P,{variant:b,pid:v,funnelKey:w.funnelKey||S,onClose:w.onClose,onSuccess:w.onSuccess,disableClose:!e,requireSecure:w.requireSecure,forceLogin:w.requireSecure,additionalInfo:I}):null),{},[w]),D=o.useRef(void 0),T=l(((n,o)=>h&&!a?Promise.resolve({userId:h,hasCreatedMember:null}):(D.current||(D.current=new Promise((r=>{x({onClose:()=>{e&&(N.close(),D.current=null,C&&C())},onSuccess:()=>{var e={userId:h||null,hasCreatedMember:null};N.close(),n&&n(),D.current=null,r(e)},funnelKey:o,requireSecure:a}),N.open()}))),D.current)),[N,h,x,a,e,C]),E=l(((o,r)=>K({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:a,requireSecure:a,closeX:e,closeOnDocClick:e,hideBoxShadow:B,extraQueryParams:{...L,funnelKey:r||S},pid:v,onSuccess:o||void 0,onClose:C,onFailure:y})),[K,n,a,e,B,L,S,v,C,y]);return null===b?{login:null,close:()=>{}}:{login:r&&"control"!==b?T:E,close:O}},_=({members:e,nonMembers:n,messageVariant:o,onClose:t,flow:s="OPTIMUS_BRANDED",funnelKey:u,pid:c})=>{var{userId:d}=r(m),f=M(),g=v("phoenix_plus"),{login:p}=w({allowClose:!0,forceLogin:!1,...o&&{flow:s,contextualMessagingVariant:o},onClose:t,funnelKey:u,pid:c}),[C,y]=a(!1),{data:S,fetching:h}=I();return i((()=>{(d||g)&&C&&!h&&(null!=S&&S.isSubscribed?f(e):f(n))}),[S,h,e,f,n,C,d,g]),l((()=>{d||g?y(!0):p&&p((()=>{y(!0)}))}),[p,y,d,g])},A=()=>{var e=g(),[{page:n}]=r(p);return l((({locationId:o,listingKey:a=null,funnelKey:r})=>{if(!o||!r)throw new Error(`Unable to record user login. Missing offer data - ${JSON.stringify({locationId:o,funnelKey:r})}`);e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:o,funnelKey:r,listingKey:a}}})}),[e,n])},U="PlusHadBlockedCards",F=()=>{var[e,n]=a(!1),[o,r]=a(new Map);return{failedCardPayment:l((a=>{if(a&&!e){var t=o.get(a);t||(t=0),(t+=1)>=5&&(n(!0),K.set(U,!0),t=0),r(new Map(o.set(a,t)))}}),[e,n,o]),hasBlockedCardInSession:l((()=>e),[e]),hadBlockedCard:l((()=>!!e||K.has(U)),[e]),clearAllBlockedCards:l((()=>{e&&n(!1),K.has(U)&&K.remove(U)}),[e,n])}},W=({children:e,forceLogin:n,loginContextualMessageKey:o,shouldLogoutAfterPaymentFailures:t=!1,renderBeforeLogout:s})=>{var{funnelKey:u}=r(h),[c,d]=a(!n),[f,g]=a(!1),[C]=r(p),{failedCardPayment:y,hasBlockedCardInSession:S,hadBlockedCard:v,clearAllBlockedCards:I}=L(),M=v()?"plus_too_many_failed_payments":o,{login:K}=w({allowClose:!1,forceLogin:n,contextualMessageKey:M,funnelKey:u,useValuePropVariant:!v()}),{userId:O}=r(m);i((()=>{O&&c||f||!K||(g(!0),K((()=>d(!0))).finally((()=>g(!1))))}),[K,c,f,O]);var P=l((()=>{window.location=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(w))}&returnTo=${encodeURIComponent(C.path)}&fullscreen=true`}),[C.path]),k=t&&S();return i((()=>{k&&P()}),[k,P]),k?s?s():null:O&&c?(I(),e({userId:O,failedCardPayment:y})):null},G=e=>!(null==e||!e.canAccessSecureContent),H=()=>{var{userId:e}=r(m),[n,o]=a(null),[t,l]=O({query:D,pause:!e},G);return i((()=>{e!==n&&(o(e),l())}),[l,n,e]),i((()=>()=>o(null)),[o]),[t,l]},$=({children:e,contextualMessageKey:n,renderNotSecure:o,skip:t,allowClose:l=!1,onClose:s})=>{var{funnelKey:u}=r(h),{login:c,close:d}=w({allowClose:l,forceLogin:!0,contextualMessageKey:n,funnelKey:u,onClose:s}),[{data:f,fetching:g},p]=T(),[C,m]=a(!1);return i((()=>{f||g||C||t||!c||c((()=>{p(),m(!0)}))}),[f,p,g,c,C,m,t]),i((()=>()=>d()),[d]),f||t?e():o?o():null};return[()=>{P=E,k=q,w=V,x=_,b=A,L=F,B=W,(N=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"CanAccessSecureContent"},"variableDefinitions":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"canAccessSecureContent"},"name":{"kind":"Name","value":"OptimusBenefits_canAccessSecureContent"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":106}}')).__key=0xb7349ab36c89,D=N,T=H,e({OptimusHardGate:B,OptimusSecureLoginGate:$,useOptimusLogin:w,useOptimusLoginNavigation:x,useOptimusLoginTracking:b})},[e=>(o=e,a=e.useState,r=e.useContext,t=e.useMemo,l=e.useCallback,i=e.useEffect),e=>s=e.default,e=>u=e.useVDOMPortal,e=>c=e.ModalContainer,e=>d=e.default,e=>(f=e.useInteractionV3Logger,g=e.useInteractionLogger),e=>(p=e.Route,C=e.TravelInfo,m=e.Visitor),e=>y=e.useOptimusSubscriptionPriceQuery,e=>S=e.useDiscountCodePersistance,e=>v=e.featureIsEnabled,e=>I=e.useOptimusSubscriptionStatusRaw,e=>M=e.useNavigate,e=>h=e.FunnelTracking,e=>K=e.default,e=>O=e.default]]},["cDcdfi","VANuRt","vq6MSq","E1X9WP","gNyFpr","fsml46","2R4xv2","BWm3Dg","P89JOf","-i3PJS","-WwUo-","1yEXVQ","ETqDaL","jaCyxS","kYmwth"]]);
