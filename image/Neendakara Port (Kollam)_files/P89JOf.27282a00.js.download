(this.$WP=this.$WP||[]).push(["P89JOf",(e,o)=>{"use strict";var t,r,i,a,c,s,n,u,p,l,d,_,m,E,C,g,D,P=()=>{var{localize:e}=_();return r((o=>{switch(o){case"REJECTED_INACTIVE":return e.string("plus_checkout_promo_code_expired");case"REJECTED_CONNECTION_ERROR":return e.string("plus_checkout_promo_code_error");case"REJECTED_INVALID_USER":return e.string("plus_checkout_promo_code_unauthorized");case"REJECTED_ALREADY_USED":return e.string("plus_checkout_promo_code_used");case"REJECTED_DISCOUNT_SERVICE_ERROR":default:return e.string("plus_checkout_promo_code_invalid")}}),[e])},v=({formFieldPrefix:e="pc",...o})=>{var{localize:l}=_(),{promoCodeForm:m,updatePromoCodeForm:g}=i(p),{appliedPromoCode:P,displayState:R,errorText:y,isApplying:f,promoCodeField:A}=m,h=D(),T=E(),I=r((()=>{T({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_link"}}}),g({displayState:"ShowPromoCodes"})}),[g,T]),O=r((e=>g({promoCodeField:{...A,value:e.toUpperCase()}})),[A,g]),S=r((()=>{T({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_apply",discountCode:A.value}}}),g({isApplying:!0})}),[g,T,A]),k=r((e=>{T({OptimusDiscountCode:{optimusAction:{pageAction:"in_view",pageProperty:"promocode_error",attribute:e}}})}),[T]),{subscriptionPrice:x}=v.useOptimusSubscriptionPrice("CHECKOUT"),{discount:N}=x||{};a((()=>{if(m.isApplying&&null!=N&&N.discountCode){var{discountCode:e,discountedPrice:o,originalPrice:t,status:r}=N;if("APPLIED"===r)g({appliedPromoCode:{amount:o-t,code:e,appliedPrice:x},isApplying:!1,promoCodeField:{...m.promoCodeField,isError:!1,value:""}});else{var i=h(r);g({appliedPromoCode:null,errorText:i,isApplying:!1,promoCodeField:{...m.promoCodeField,isError:!0,value:e}})}}}),[h,m,N,g,x]);var b=r((e=>h("REJECTED_CONNECTION_ERROR")===e?"connection_error":h("REJECTED_DISCOUNT_SERVICE_ERROR")===e?"invalid_code":h("REJECTED_INVALID_USER")===e?"unauthorized":h("REJECTED_ALREADY_USED")===e?"already_used":h("REJECTED_INACTIVE")===e?"cancelled_expired":""),[h]);return a((()=>{if(A.isError&&y){T({OptimusDiscountCode:{optimusAction:{pageAction:"failed",pageProperty:"promocode"}}});var e=b(y);k(e)}}),[A,y,T,b,k]),t.createElement(n,o,t.createElement(u,{dividers:!0,space:"spacing-03"},t.createElement(t.Fragment,null),"ShowPromoCodes"===R&&!P&&t.createElement(n,{display:"flex",className:"cwEPK O f"},t.createElement(C,{errorText:A.isError?y:void 0,id:`${e}-promoCodeInput`,marginRight:"spacing-03",onChange:e=>O(e.currentTarget.value),placeholder:l.string("plus_checkout_promo_code_placeholder"),state:A.isError?"error":"enabled",type:"text",value:A.value}),t.createElement(c,{dataAttributes:{"data-automation":"applyDiscount"},disabled:f,onClick:()=>A.value&&S(),variant:"secondary"},t.createElement(d,{id:"plus_checkout_promo_code_apply"}))),"ShowLink"===R&&t.createElement(n,{marginY:"spacing-03"},t.createElement(s,{dataAttributes:{"data-automation":"showDiscountInput"},onClick:I},t.createElement(d,{id:"plus_checkout_promo_code"})))))};function R(e,o){var t=E(),{updatePromoCodeForm:a}=i(p),c=m(),{localize:s}=_(),n=m(),u=r((()=>{t({OptimusDiscountCode:{optimusAction:{pageAction:"success",pageProperty:"promocode"}}})}),[t]),l=null==e?void 0:e.discountCode;if(!e||!l)return null;var d=c.formatCurrencyInteger(e.originalPrice),C=e.discountedPrice-e.originalPrice,{expiryDate:g}=e,D=g?n.formatDate("date_short",new Date(g)):null,P=o?s.string("plus_partner_discount_tooltip",{0:o}):s.string("plus_first_year_discount_title"),v=`${s.string("plus_first_year_discount_body",{originalPrice:d})}\n  ${D?s.string("plus_discount_expire_date",{expireDate:D}):""}`;return{onRemove:()=>a({appliedPromoCode:null}),price:C,rawPrice:C,title:l,...e.discountedPrice>0?{tooltipTitle:P,tooltipBody:v}:null,variant:"DISCOUNT",onRemoveVisible:u}}var y=()=>{var e="discountCode";return{setDiscountCode:o=>{g.set(e,o,864e5)},getDiscountCode:()=>g.get(e),clearDiscountCode:()=>{g.remove(e)}}};return e("useDiscountCharge",R),[()=>{D=P,v.useOptimusSubscriptionPrice=l,e({default:v,useDiscountCharge:R,useDiscountCodePersistance:y})},[e=>(t=e.default,r=e.useCallback,i=e.useContext,a=e.useEffect),e=>(c=e.default,s=e.BorderlessButton),e=>(n=e.Box,u=e.Stack),e=>p=e.Payment,e=>l=e.useOptimusSubscriptionPrice,e=>(d=e.default,_=e.useLocalize,m=e.useIntlFormatter),e=>E=e.useInteractionLogger,e=>C=e.TextInput,e=>g=e.default]]},["cDcdfi","7yGKf-","SzaY02","ENvJHX","BWm3Dg","0DsHEV","fsml46","7bbexq","jaCyxS"]]);
