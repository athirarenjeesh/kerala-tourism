(this.$WP=this.$WP||[]).push(["S07X1M/mAbcFr",(e,a)=>{"use strict";var o,i,t,l,r,n,d,s,u,p,c,m,v,f,h,g,k,b,U,F,w,C,_=(e,a)=>{var[i,t]=o.useState(!1),l=u();return p("dragover",(e=>{var a=e;null!=a.dataTransfer&&[...a.dataTransfer.items].some((e=>"file"===e.kind))&&(a.dataTransfer.dropEffect="copy",a.preventDefault(),t(!0))})),p("dragleave",(e=>{i&&(e.preventDefault(),t(!1))})),p("drop",(o=>{if(i){var r=o;r.preventDefault(),t(!1);var n=[];null!=r.dataTransfer&&(n=(r.dataTransfer.items?[...r.dataTransfer.items].map((e=>e.getAsFile())):[...r.dataTransfer.files]).filter(Boolean)),n.length>0&&(null!==a&&l({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:a.length.toString()}}}),e(n))}})),{dragging:i}},y=(e,a,i)=>{var{localize:t}=l(),r=o.useCallback((e=>"video"===i?`${e.name}: ${t.string("post_video_file_type_error")}`:`${e.name}: ${t.string("post_photo_unsupported_file")}`),[t,i]),n=o.useCallback((e=>"video"===i?`${e.name}: ${t.string("post_video_size_error")}`:`${e.name}: ${t.string("file_size_too_big_photo_oops_message",{0:t.string("mobile_offline_megabyte_ffffec6c",{0:a/1024/1024})})}`),[t,a,i]);return o.useCallback((o=>{if(o.size>a)return Promise.reject(new Error(n(o)));var t=c(o.name);return t&&e.includes(t)?"video"===i?Promise.resolve():new Promise(((e,a)=>{var i=new Image;i.onload=()=>{URL.revokeObjectURL(i.src),e()},i.onerror=()=>a(new Error(r(o))),i.src=URL.createObjectURL(o)})):Promise.reject(new Error(r(o)))}),[e,a,r,n,i])},S=(e,a,o,i)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:a.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:a.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:a.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${o+1} of ${i}`}}})},P=()=>{var e=u(),[a,i]=o.useState(),t=o.useRef(!1);o.useEffect((()=>(t.current=!0,()=>{t.current=!1})),[]);var[,l]=f(g),[,r]=f(b),n=o.useCallback((e=>{if(t.current)return e;throw new Error("upload aborted")}),[]),d=o.useCallback((({mediaType:a,file:o,description:t,locationId:d,isForCuration:s},u,p)=>{var c={description:t,mediaType:"video"===a?"VIDEO":"PHOTO",mimeType:o.type,fileName:o.name,fileSize:o.size,locationIds:null!=d&&d>0?[d]:[],isForCuration:s};return("video"===a?l({request:c}):(e=>new Promise(((a,o)=>{var i=new Image;i.onload=()=>{URL.revokeObjectURL(i.src),a({width:i.width,height:i.height})},i.onerror=o,i.src=URL.createObjectURL(e)})))(o).then((({width:e,height:a})=>l({request:{...c,width:e,height:a}})))).then(n).then((({data:t,error:l})=>{var r,n,d;if(l||"OK"!==(null==t||null==(r=t.initiateMediaUpload)?void 0:r.status)||null==(null==t||null==(n=t.initiateMediaUpload)?void 0:n.mediaId)||null==(null==t||null==(d=t.initiateMediaUpload)?void 0:d.uploadUrl))throw new Error("Upload failed");var{mediaId:s,uploadUrl:c}=t.initiateMediaUpload;return((e,a,o,t,l,r,n,d)=>new Promise(((d,s)=>{var p=new XMLHttpRequest;p.open("PUT",o,!0),p.onload=()=>{200===p.status?(n||t({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${l+1} of ${r}`}}}),d(a)):(n||S(t,p,l,r),s(new Error(`Upload of file ${e.name} failed.`)))},p.onerror=()=>{n||S(t,p,l,r),s(new Error(`Upload of file ${e.name} failed.`))},p.onabort=()=>s(new Error(`Upload of file ${e.name} aborted.`)),p.upload.onprogress=e=>{return a=e.loaded,i((e=>{var o=null==e?[]:[...e];return o[u]=a,o}));var a},p.send(e)})))(o,s,c,e,u,p.length,"video"===a)})).then(n).then((e=>r({request:{mediaId:e}}).then((()=>({mediaId:e}))))).finally((()=>{i(null)}))}),[l,r,n,e]);return[{progress:a},o.useCallback((e=>Promise.all(e.map(d))),[d])]},T=({mediaType:e,withMetadata:a,isForCuration:i,allowedFileTypes:t,maxFileSize:r,maxAllowedFiles:n,locationId:d})=>{var s=u(),{localize:p}=l(),c=y(t,r,e),[m,v]=o.useState({media:[],error:null}),f=o.useCallback((e=>{v((a=>({...a,error:e})))}),[]),[h,g]=o.useState(!1),k="video"===e,b=k?F.maxAllowedFiles:U.maxAllowedFiles,w=o.useCallback((a=>{c(a).then((()=>{v((o=>o.media.some((e=>{return o=e.file,i=a,o.name===i.name&&o.size===i.size;var o,i}))?o:o.media.length>=n?n!==b?o:{error:k?p.string("video_upload_max_number",{nVideos:n}):p.string("post_photo_tips_guidelines"),media:o.media}:{error:o.error,media:[...o.media,{mediaType:e,file:a,description:"",locationId:d,isForCuration:i}]}))})).catch((e=>{k||s({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),f(e.message)}))}),[c,n,i,d,p,f,e,b,k,s]),C=o.useCallback((e=>{f(null),e.preventDefault(),[...e.target.files].forEach(w),k||s({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:m.media.length.toString()}}}),e.currentTarget.value=""}),[w,f,s,k,m.media.length]),S=o.useCallback(((e,a)=>{v((o=>{var i=[...o.media];return i[e]=a,{error:null,media:i}}))}),[]),T=o.useCallback((e=>{v((a=>{var o=[...a.media];return o.splice(e,1),{error:null,media:o}}))}),[]),{dragging:I}=_((e=>{f(null),e.forEach(w)}),k?null:m.media),E=!h&&m.media.length>0&&(!a||!k&&i||m.media.every((e=>e.description&&null!=e.locationId&&e.locationId>0))),[{progress:N},x]=P(),M=o.useCallback((()=>E?(k||s({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),g(!0),f(null),x(m.media).then((e=>(k||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),g(!1),e))).catch((()=>{k||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}});var e=k?p.string("video_upload_fail"):p.string("post_photo_upload_failed");f(e),g(!1)}))):Promise.reject()),[x,E,m.media,f,p,k,s]);return{media:m.media,error:m.error,uploading:h,progress:N,canAddMore:m.media.length<n,canSubmit:E,dragging:I,onFileSelected:C,onMediaChanged:S,onMediaDeleted:T,onSubmit:M}},I=({children:e,...a})=>{var[i]=o.useContext(n),l=o.useRef(),r={...U,...a},[s,u]=o.useState([]),[{progress:p},c]=P(),m=y(r.allowedFileTypes,r.maxFileSize),v=o.useRef([]),f=o.useCallback((e=>{v.current.splice(0,0,e)}),[]),h=o.useCallback((e=>{var a=v.current.findIndex((a=>e===a));v.current.splice(a,1)}),[]),g=o.useCallback((e=>{Promise.all(e.map((e=>m(e)))).then((()=>{var a=e.map((e=>({mediaType:"photo",file:e,locationId:null,description:"",isForCuration:r.isForCuration})));return u(a),c(a)})).then((e=>{v.current.find((a=>!1!==a(e)))})).catch((e=>{i({node:o.createElement(d,null,e.message||o.createElement(t,{id:"post_photo_upload_failed"}))})})).finally((()=>{u([])}))}),[m,c,i,r.isForCuration]),{dragging:k}=_(g,s),b=o.useCallback((()=>{var e=l.current;if(null==e)throw new Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()}),[]),F=o.useMemo((()=>({photos:s,open:b,dragging:k,progress:p,addPhotosUploadedCallback:f,removePhotosUploadedCallback:h})),[s,b,k,p,f,h]);return o.createElement(w.Provider,{value:F},e,o.createElement("input",{ref:l,type:"file",multiple:r.maxAllowedFiles>1,accept:r.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),g([...e.currentTarget.files].filter(Boolean)),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1}))},E=e=>{var{addPhotosUploadedCallback:a,removePhotosUploadedCallback:i,...t}=o.useContext(w),l=o.useRef(e);return l.current=e,o.useEffect((()=>{if(null==l.current)return()=>{};var e=(...e)=>!!l.current&&l.current(...e);return a(e),()=>{i(e)}}),[a,i]),t},N=(e=Object.freeze({}))=>{var a=u(),{login:l}=s(),[r]=o.useContext(n),p=o.useRef((()=>{})),{open:c}=i((({close:a})=>o.createElement(C,Object.assign({},e,{onUploadCanceled:()=>{a(),p.current([])},onUploadSuccess:(...i)=>{a(),r({node:o.createElement(d,null,"video"===e.mediaType?o.createElement(t,{id:"success_repost_video"}):o.createElement(t,{id:"success_repost_photo"}))}),p.current(...i)}}))),{},[e,r]);return o.useCallback((()=>l({flow:"CORE_COMBINED"}).then((()=>(c(),"video"!==e.mediaType&&a({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise((e=>{p.current=e})))))),[l,c,a,e.mediaType])};return[()=>{(h=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"InitializeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"InitiateMediaUploadRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"initiateMediaUpload"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"mediaId"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"uploadUrl"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":165}}')).__key=0xc803ecdf4604,g=h,(k=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"FinalizeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"CompleteMediaUploadForClientRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"completeMediaUploadForClient"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[]}]}}],"loc":{"start":0,"end":138}}')).__key=0x61dd9d92ebbe,b=k,U={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:m,maxAllowedFiles:10,locationId:-1},F={mediaType:"video",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:v,maxAllowedFiles:5,locationId:-1},w=o.createContext({photos:[],open:()=>{},dragging:!1,progress:null,addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),C=r.onUsage((()=>a("S07X1M/v-c-G4")),"default"),e({C:I,a:U,b:N,c:E,d:F,u:T})},[e=>o=e.default,e=>i=e.useVDOMPortal,e=>(t=e.default,l=e.useLocalize),e=>r=e.component,e=>(n=e.Toast,d=e.ToastItem),e=>s=e.default,e=>u=e.useInteractionLogger,e=>p=e.useWindow,e=>(c=e.fileExtension,m=e.maxImageUploadSizeInBytes,v=e.maxVideoUploadSizeInBytes),e=>f=e.useMutation]]},["cDcdfi","vq6MSq","0DsHEV","pLbCP4","Q7TAd7","VANuRt","fsml46","Dg5_-9","V_I8wA","5X2em-"]]);
