(this.$WP=this.$WP||[]).push(["NkmoMN",(e,t)=>{"use strict";var s,a,n,r,i,o,l,u,c,d,p,m,g,v,_,h,b,k,f,I,S,w,y,E,M,x,P,C,R=e=>{var{page:t,params:s}=e,a=s.showHighlightOnHR?s.showHighlightOnHR:null;return"Hotel_Review"===t&&1===a},H=(e,t,s)=>{var a={...e.current};a[t]=[...new Set([...a[t]||[],s])],e.current=a},O=["vf_awareness_campaign_1632751047"],A="edu_general",N="edu_hotels",D="edu_experiences",T="edu_general_p2",V="edu_hotels_p2",F="edu_experiences_p2",U="edu_general_p3",L="edu_hotels_p3",K="edu_experiences_p3",G=["Attractions","Attraction_Review","AttractionsFusion","AttractionsHome","AttractionsNear","AttractionToursAndTickets"],$=["Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],j=["Attraction_Products","AttractionProductReview","AttractionProductsFusion","OptimusHotelCheckout","OptimusSubscriptionCheckout","Plus","Restaurant_Review","Restaurants","RestaurantsHome","RestaurantsNear"],q=["AttractionsHome","Attractions","AttractionsFusion","Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],B="control",z=e=>S.includes(e),J="interstitialPageViews",Q="interstitialDelayPageViews",W="sessionPreviouslySeenInterstitial",X="sessionPreviouslySeenInterstitialGhost",Y="previouslyIntervalSeenInterstitial",Z="previouslySeenInterstitialTotalV2",ee="previouslyIntervalSeenInterstitialGhost",te="previouslySeenInterstitialTotalGhostV2",se="interstitialIneligibilityLogged",ae=/^https?:\/\/[a-z\-\.]+\.tripadvisor\.[a-z\-\.]+/,ne=()=>g.get(J)||0,re=()=>g.get(Q)||0,ie=()=>g.get(Y)||!1,oe=()=>g.get(Z)||0,le=()=>v.get(W)||0,ue=()=>g.get(ee)||!1,ce=()=>g.get(te)||0,de=()=>v.get(X)||0,pe=({children:e,onShow:t,delaySeconds:a,delayPageViews:n,afterPageViews:r,maxSeen:i,maxSeenSession:o,variantName:l,isDatePickerOpen:d,suppress:m,ignoreInterval:b,onSkip:k,fallback:f=null,isControl:I=!1})=>{var S=s.useMemo(ne,[]),w=s.useMemo(re,[]),M=s.useMemo(ie,[]),x=s.useMemo(oe,[]),P=s.useMemo(le,[]),C=s.useMemo(ue,[]),R=s.useMemo(ce,[]),O=s.useMemo(de,[]),A=s.useRef({}),[N,D]=s.useState(!1),{funnelKey:T}=s.useContext(p),[{page:V},{uid:F}]=s.useContext(u),{sessionId:U,userId:L}=s.useContext(c),K=_(),G=h();s.useEffect((()=>{!b&&M||g.set(J,S+1)}),[S,M,b]),s.useEffect((()=>{(m||d)&&D(!1)}),[m,d]);var $=s.useMemo((()=>{var e=document.referrer;return!!e&&!ae.test(e)}),[]),j=s.useMemo((()=>!d&&S>=r&&(b||!M)&&x<i&&P<o),[d,S,r,M,x,P,i,o,b]);return s.useEffect((()=>{!j&&k&&k()}),[j,k]),s.useEffect((()=>{var e=!!$&&w<n;if(j){e&&g.set(Q,w+1);var s=setTimeout((()=>{document.querySelector('[title="regcontroller"]')||document.getElementById("explicitPreferences")||((b||!C)&&O<o&&x<i&&j&&!d&&(K({optimusMarketingInterstitial:{name:I?`control_${l}`:l,pageviewUid:F}}),I&&(v.set(X,O+1),g.set(ee,!0,y),g.set(te,R+1,E))),m||!j||d||(v.set(W,P+1),g.set(Y,!0,y),g.set(Z,x+1,E),D(!0),t&&t()))}),e?1e3*a:0);return()=>clearTimeout(s)}return g.get(se)||(S<r&&H(A,"common","notEnoughPageViews"),M&&H(A,"common","seenMaxInterval"),P>=o&&H(A,"common","seenMaxSession"),x>=i&&H(A,"common","seenMaxOverall"),Object.keys(A.current).length>0&&(g.set(se,!0,y),G({externalKey:T,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:V,pageUid:F,sessionId:U,team:"Plus",userId:L,customData:JSON.stringify({...A.current})}))),()=>{}}),[j,$,D,a,n,w,P,O,x,R,C,i,o,d,t,m,K,F,l,I,b,G,T,V,U,L,A,S,r,M]),N?e:f},me="plusMarketingInterstitial",ge="edu_endless",ve="edu_general",_e="edu_hotels",he="edu_experiences",be="edu_general_p2",ke="edu_hotels_p2",fe="edu_experiences_p2",Ie="edu_general_p3",Se="edu_hotels_p3",we="edu_experiences_p3",ye=({delaySeconds:e=30,afterPageViews:t=0,delayPageViews:l=1,maxSeen:m=3,maxSeenSession:g=1,isDatePickerOpen:v,onPopupDismiss:_,onOpen:f,onClose:S,fallback:y=null})=>{var E=r({}),[J,Q]=n(null),{isOptimusEnabled:W,isOptimusSubscribed:X}=k(),[{page:Y,params:Z},{uid:ee}]=a(u),te=Z.discountCode||null,se=(e=>{var t=(e=>{var t,[s]=a(u),{userId:n}=a(c),{cashbackEnabled:r}=I(),i=(e=>j.includes(e.page)||(e=>{var{page:t,params:s}=e,a=s.showHighlightOnHR?s.showHighlightOnHR:null;return"Hotel_Review"===t&&1!==a})(e))(s);r&&!i&&(t="vf_awareness_campaign_1632751047");var o=[];t&&o.push(t);var l=b({experimentKeys:o,userId:n||void 0});if(null===r||null===l)return null;var d=t?l[t]:null;return d===B?(H(e,"cashbackAwareness","control"),B):(r||H(e,"cashbackAwareness","cashbackDisabled"),i&&H(e,"cashbackAwareness","excludedPage"),d&&w.includes(d)?"p3"===d?$.includes(s.page)||R(s)?L:G.includes(s.page)?K:U:"p2"===d?$.includes(s.page)||R(s)?V:G.includes(s.page)?F:T:$.includes(s.page)||R(s)?N:G.includes(s.page)?D:A:"")})(e);return null===t?null:t})(E),ae=(()=>{var[{page:e,params:t}]=a(u),s=t.discountCode||null,n=!("Plus"!==e||!t.autopop&&""!==t.autopop||!s),r="Plus"===e&&null!==t.autopop&&"SUMMER0"===t.autopop;return n||r})(),ne=(e=>{var[t]=a(u);return z(e)&&(q.includes(t.page)||R(t))})(J),re=(()=>{var{userId:e}=a(c),t=b({experimentKeys:O,userId:e||void 0,skipImpression:!0});return null===t?null:Object.keys(t).length>0})(),ie=h(),{funnelKey:oe}=a(p),{sessionId:le,userId:ue}=a(c),{viewportCategory:ce}=a(d),de="MOBILE"===ce;i((()=>{null===J&&Q(se)}),[oe,ie,se,W,X,Y,ee,J,le,ue]),i((()=>{null!==J&&(W||H(E,"common","optimusDisabled"),X&&H(E,"common","alreadySubscribed"),ne&&de&&H(E,"cashbackAwareness","mobileSupressed"),re&&Object.keys(E.current).length>0&&ie({externalKey:oe,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:Y,pageUid:ee,sessionId:le,team:"Plus",userId:ue,customData:JSON.stringify({...E.current})}))}),[oe,ie,ne,re,de,W,X,Y,ee,J,le,ue]);var pe=o((()=>{S&&S(),_&&_()}),[S,_]);if(null===J||null===re)return null;if("control"===J||!W||X||!J)return _&&_(),y;var ye=(({variant:e,discountCode:t,onInterstitialClose:a})=>C.includes(e)?(({variant:e,onInterstitialClose:t})=>{var a;switch(e){case ge:a="endless";break;case ve:a="earn-general";break;case _e:a="earn-hotels";break;case he:a="earn-experiences";break;case be:a="earn-general-p2";break;case ke:a="earn-hotels-p2";break;case fe:a="earn-experiences-p2";break;case Ie:a="earn-general-p3";break;case Se:a="earn-hotels-p3";break;case we:a="earn-experiences-p3";break;default:throw new Error(`Education interstitial not implemented for variant ${e}`)}return s.createElement(P,{variant:a,onClose:()=>t(),dataAutomationTag:me})})({variant:e,onInterstitialClose:a}):(({variant:e,discountCode:t,onInterstitialClose:a})=>{var n,r=null==t?void 0:t.toUpperCase();switch(e){case"test_bubble":n="community";break;case"test_cactus":n="savings";break;case"low_discount":n="endless_a",r="SUMMER25";break;case"medium_discount":n="endless_b",r="SUMMER50";break;case"high_discount":n="endless_c",r="SUMMER75";break;default:throw new Error(`Discount interstitial not implemented for variant ${e}`)}return s.createElement(x,{code:r||"25OFF",onClose:()=>a(),variant:n,dataAutomationTag:me})})({variant:e,discountCode:t,onInterstitialClose:a}))({variant:J,discountCode:te,onInterstitialClose:pe}),Ee=m,Me=g;return ae?(Ee=Number.MAX_SAFE_INTEGER,Me=Number.MAX_SAFE_INTEGER):z(J)&&(Ee=2,Me=1),s.createElement(M,{delaySeconds:e,delayPageViews:ae?0:l,afterPageViews:t,maxSeen:Ee,maxSeenSession:Me,variantName:J,isDatePickerOpen:v,onSkip:_,ignoreInterval:ae,onShow:f,fallback:y,suppress:ne&&de},ye)},Ee=e=>{var[t]=n(l());return s.createElement(m,{funnelKey:t},s.createElement(ye,e))};return[()=>{S=[D,A,N,T,V,F,U,L,K],w=["p1","p2","p3"],y=864e5,E=6048e5,M=pe,x=f.component.onUsage((()=>t("_MrER3")),"default"),P=f.component.onUsage((()=>t("NkmoMN/DVf7dM")),"default"),C=[ge,ve,_e,he,be,ke,fe,Ie,Se,we],e("default",Ee)},[e=>(s=e.default,a=e.useContext,n=e.useState,r=e.useRef,i=e.useEffect,o=e.useCallback),e=>l=e.uuid,e=>(u=e.Route,c=e.Visitor,d=e.Device),e=>(p=e.FunnelTracking,m=e.FunnelTrackingProvider),e=>g=e.default,e=>v=e.default,e=>(_=e.useImpressionLogger,h=e.useImpressionV3Logger),e=>b=e.default,e=>k=e.useOptimusEnabledForUser,e=>f=e,e=>I=e.useCashbackEnabledRaw]]},["cDcdfi","O-HcBE","2R4xv2","ETqDaL","jaCyxS","qKFflQ","30t50h","S-RL4Q","v_y45t","pLbCP4","tVuenP"]]);
